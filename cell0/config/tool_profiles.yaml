# Tool Profiles Configuration for Cell 0 OS
# Defines security profiles for agent tool access

profiles:
  # Minimal profile - read-only access
  - name: minimal
    description: "Read-only access to files. No network, no execution. Safe for viewing code and documentation."
    version: "1.0.0"
    
    group_policies:
      group:fs:
        permission: ALLOW
        risk_level: low
        allowed_paths:
          - "./workspace/*"
          - "./src/*"
          - "./docs/*"
        denied_paths:
          - "*/.*"
          - "*/secrets/*"
          - "*/.env*"
          - "*/credentials*"
      
      group:system:
        permission: ALLOW
        risk_level: low
    
    tool_policies:
      read:
        permission: ALLOW
        risk_level: low
      
      file_info:
        permission: ALLOW
        risk_level: low
      
      list_dir:
        permission: ALLOW
        risk_level: low
      
      write:
        permission: DENY
        risk_level: medium
      
      edit:
        permission: DENY
        risk_level: medium
      
      delete:
        permission: DENY
        risk_level: critical
      
      exec:
        permission: DENY
        risk_level: high
      
      web_search:
        permission: DENY
        risk_level: medium
      
      web_fetch:
        permission: DENY
        risk_level: medium
      
      browser_navigate:
        permission: DENY
        risk_level: medium
      
      message_send:
        permission: DENY
        risk_level: high
  
  # Coding profile - standard development tasks
  - name: coding
    description: "Standard development tasks. File operations, local execution, web search."
    version: "1.0.0"
    inherits: minimal
    
    group_policies:
      group:fs:
        permission: ALLOW
        risk_level: medium
        allowed_paths:
          - "./workspace/*"
          - "./src/*"
          - "./tests/*"
          - "./config/*"
          - "./scripts/*"
        denied_paths:
          - "*/secrets/*"
          - "*/.env*"
      
      group:runtime:
        permission: ALLOW
        risk_level: medium
        rate_limit: 30
        sandbox_config:
          timeout: 300
          memory_limit: 512m
          network: false
      
      group:network:
        permission: ALLOW
        risk_level: medium
        rate_limit: 60
      
      group:code:
        permission: ALLOW
        risk_level: low
    
    tool_policies:
      write:
        permission: ALLOW
        risk_level: medium
        allowed_paths:
          - "./workspace/*"
          - "./src/*"
          - "./tests/*"
      
      edit:
        permission: ALLOW
        risk_level: medium
        allowed_paths:
          - "./workspace/*"
          - "./src/*"
          - "./tests/*"
      
      copy:
        permission: ALLOW
        risk_level: medium
      
      move:
        permission: ALLOW
        risk_level: medium
      
      exec:
        permission: ALLOW
        risk_level: medium
        rate_limit: 10
        sandbox_config:
          timeout: 60
          memory_limit: 512m
          network: false
      
      process:
        permission: ALLOW
        risk_level: medium
        rate_limit: 10
      
      web_search:
        permission: ALLOW
        risk_level: medium
        rate_limit: 30
      
      web_fetch:
        permission: ALLOW
        risk_level: medium
        rate_limit: 60
      
      code_complete:
        permission: ALLOW
        risk_level: low
      
      code_analyze:
        permission: ALLOW
        risk_level: low
  
  # Messaging profile - communication capabilities
  - name: messaging
    description: "Communication with external channels. Email, chat, notifications. Requires caution."
    version: "1.0.0"
    inherits: coding
    
    group_policies:
      group:messaging:
        permission: ALLOW
        risk_level: high
        rate_limit: 10
        requires_approval_above: 10  # More than 10 recipients needs approval
      
      group:browser:
        permission: ALLOW
        risk_level: medium
        rate_limit: 30
    
    tool_policies:
      message_send:
        permission: ALLOW
        risk_level: high
        rate_limit: 10
      
      message_broadcast:
        permission: ALLOW
        risk_level: high
        rate_limit: 5
      
      message_react:
        permission: ALLOW
        risk_level: low
        rate_limit: 30
      
      email_send:
        permission: ALLOW
        risk_level: high
        rate_limit: 5
        requires_approval_above: 1  # External emails need approval
      
      notify:
        permission: ALLOW
        risk_level: medium
        rate_limit: 20
      
      browser_navigate:
        permission: ALLOW
        risk_level: medium
        rate_limit: 30
      
      browser_click:
        permission: ALLOW
        risk_level: medium
      
      browser_type:
        permission: ALLOW
        risk_level: medium
      
      browser_screenshot:
        permission: ALLOW
        risk_level: low
  
  # Full profile - elevated access with sandboxing
  - name: full
    description: "Full access with sandboxing for high-risk operations. Use with extreme caution."
    version: "1.0.0"
    inherits: messaging
    
    group_policies:
      group:system:
        permission: ALLOW
        risk_level: high
      
      group:external:
        permission: ALLOW
        risk_level: high
        rate_limit: 20
        sandbox_config:
          timeout: 60
          network: true
      
      group:data:
        permission: ALLOW
        risk_level: medium
    
    tool_policies:
      delete:
        permission: ELEVATED
        risk_level: critical
        requires_approval_above: 0  # Always requires approval
      
      exec:
        permission: SANDBOX
        risk_level: high
        sandbox_config:
          timeout: 300
          network: true
          memory_limit: 1g
          cpu_limit: "1.0"
      
      process_kill:
        permission: ELEVATED
        risk_level: high
      
      signal:
        permission: ELEVATED
        risk_level: high
      
      api_call:
        permission: ALLOW
        risk_level: high
        rate_limit: 30
      
      webhook_trigger:
        permission: ELEVATED
        risk_level: critical
        requires_approval_above: 0
      
      db_query:
        permission: ALLOW
        risk_level: medium
        rate_limit: 60
      
      cache_set:
        permission: ALLOW
        risk_level: low
      
      kv_set:
        permission: ALLOW
        risk_level: low
  
  # Sandbox-only profile - everything runs in sandbox
  - name: sandbox
    description: "All operations run in sandbox. Maximum isolation."
    version: "1.0.0"
    
    default_policy:
      permission: SANDBOX
      risk_level: medium
      sandbox_config:
        timeout: 60
        memory_limit: 512m
        network: false
    
    group_policies:
      group:fs:
        permission: SANDBOX
        risk_level: low
        sandbox_config:
          read_write_paths:
            - "./workspace/*"
      
      group:runtime:
        permission: SANDBOX
        risk_level: high
        sandbox_config:
          timeout: 300
          memory_limit: 1g
          network: false
      
      group:network:
        permission: SANDBOX
        risk_level: medium
        sandbox_config:
          network: true
          allowed_hosts:
            - "api.github.com"
            - "pypi.org"
            - "docs.python.org"
  
  # CI/CD profile - for build and deployment
  - name: ci
    description: "Continuous integration tasks. Build, test, deploy with restrictions."
    version: "1.0.0"
    inherits: coding
    
    group_policies:
      group:runtime:
        permission: ALLOW
        risk_level: medium
        sandbox_config:
          timeout: 1800  # 30 minutes
          memory_limit: 4g
          network: true
    
    tool_policies:
      exec:
        permission: ALLOW
        risk_level: medium
        sandbox_config:
          timeout: 1800
          memory_limit: 4g
          network: true
      
      # Deny destructive operations even in CI
      delete:
        permission: ELEVATED
        risk_level: critical
      
      webhook_trigger:
        permission: DENY
        risk_level: critical

# Provider-specific policy templates
providers:
  filesystem:
    default_policy:
      permission: ALLOW
      risk_level: medium
      allowed_paths:
        - "./workspace/*"
      denied_paths:
        - "*/.env*"
        - "*/secrets/*"
  
  runtime:
    default_policy:
      permission: SANDBOX
      risk_level: high
      sandbox_config:
        timeout: 300
        memory_limit: 512m
  
  network:
    default_policy:
      permission: ALLOW
      risk_level: medium
      rate_limit: 60
  
  browser:
    default_policy:
      permission: ALLOW
      risk_level: medium
      rate_limit: 30
  
  messaging:
    default_policy:
      permission: ALLOW
      risk_level: high
      rate_limit: 10
  
  database:
    default_policy:
      permission: ALLOW
      risk_level: medium
      rate_limit: 100
  
  external:
    default_policy:
      permission: ELEVATED
      risk_level: critical

# Tool groups definition
groups:
  group:fs:
    description: "File system operations"
    tools:
      - read
      - write
      - edit
      - delete
      - copy
      - move
      - list_dir
      - file_info
      - watch_file
  
  group:runtime:
    description: "Process and execution"
    tools:
      - exec
      - process
      - spawn
      - kill
      - signal
  
  group:network:
    description: "Network access"
    tools:
      - web_search
      - web_fetch
      - http_request
      - download
  
  group:browser:
    description: "Browser automation"
    tools:
      - browser_navigate
      - browser_click
      - browser_type
      - browser_screenshot
      - browser_evaluate
  
  group:messaging:
    description: "Communication"
    tools:
      - message_send
      - message_broadcast
      - message_react
      - email_send
      - notify
  
  group:system:
    description: "System information"
    tools:
      - system_info
      - env_get
      - env_set
      - config_read
      - config_write
  
  group:code:
    description: "Code operations"
    tools:
      - code_complete
      - code_analyze
      - code_lint
      - code_format
  
  group:data:
    description: "Data operations"
    tools:
      - db_query
      - cache_get
      - cache_set
      - kv_get
      - kv_set
  
  group:external:
    description: "External integrations"
    tools:
      - api_call
      - webhook_trigger
      - integration_invoke
